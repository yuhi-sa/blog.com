---
title: "Reparameterization trick"
date: 2022-02-06T15:00:23+09:00
draft: false
tags: ["MachineLearning"] 
---
<!--more-->
In deep learning models, sampling from a probability distribution is typically a non-differentiable operation. This makes it impossible to use backpropagation to compute gradients and update model parameters.

To address this issue, the **Reparameterization Trick** was introduced by D. P. Kingma and M. Welling in their Variational Autoencoder (VAE) paper.

## Principle

The Reparameterization Trick makes the sampling process differentiable by separating the sampling operation into two parts: **random noise independent of the parameters** and a **deterministic transformation dependent on the parameters**.

For example, consider sampling a random variable $z$ from a normal distribution $\mathcal{N}(\mu, \sigma^2)$ with mean $\mu$ and variance $\sigma^2$:

$ z \sim \mathcal{N}(\mu, \sigma^2) $

This sampling operation is non-differentiable. However, by using random noise $\epsilon$ sampled from a standard normal distribution $\mathcal{N}(0, 1)$, $z$ can be expressed as:

$ z = \mu + \sigma \odot \epsilon $
$ \text{where } \epsilon \sim \mathcal{N}(0, 1) $

($\odot$ denotes element-wise multiplication. In the multi-dimensional case, $\sigma$ corresponds to the vector of standard deviations or the square root of the covariance matrix.)

This transformation makes $z$ a deterministic function with respect to $\mu$ and $\sigma$, allowing $\mu$ and $\sigma$ (which are typically outputs of a neural network) to be differentiable. The randomness is encapsulated in $\epsilon$, and gradients can be backpropagated through $\mu$ and $\sigma$.

![Concept Diagram](.././repara.png)


## Sampling using the Reparameterization Trick in PyTorch
```
m = Normal(*params)
z = m.rsample()
```
The probability distributions that can use sampling using the reparameterization trick are those that have the value True for:
```
m.has_rsample
```

## References
- [D. P. Kingma and M. Welling, “Auto-encoding variational bayes”, 2013.](https://arxiv.org/abs/1312.6114)
- [ReNom, 変分オートエンコーダ](https://www.renom.jp/ja/notebooks/tutorial/generative-model/VAE/notebook.html)
