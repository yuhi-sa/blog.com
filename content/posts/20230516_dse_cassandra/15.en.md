---
title: "DS201 Study Notes: Cassandra NodeSync"
date: 2023-06-29T09:00:23+09:00
draft: false
tags: ["Cassandra", "DataStax"]
description: "DS201 course study notes on DSE's NodeSync feature: continuous data validation and automatic repair as a replacement for nodetool repair."
---
<!--more-->
Study notes from [DS201: Foundations of Apache Cassandraâ„¢ and DataStax Enterprise](https://www.datastax.com/jp/resources/datasheet/ds201-datastax-enterprise-foundations-apache-cassandratm).

## NodeSync

**NodeSync** is a feature provided by DataStax Enterprise (DSE) that continuously verifies data consistency within a Cassandra cluster and automatically repairs inconsistencies. It is designed as a more efficient and lower-overhead alternative to traditional anti-entropy repair (e.g., `nodetool repair`) for maintaining data consistency.

### Key Features of NodeSync

-   **Continuous verification and repair**:
    Continuously verifies data synchronization across all replicas and automatically performs repairs when inconsistencies are found.
-   **Low overhead**:
    Always runs in the background with minimal impact on cluster performance.
-   **Fully automated**:
    No manual intervention is required, automating data consistency maintenance.
-   **Anti-entropy repair replacement**:
    Functions as an alternative to the traditional `nodetool repair` command, providing a more efficient method for ensuring data consistency.

### How It Works

The NodeSync service runs on each node by default. NodeSync can be enabled **per table**, and it continuously validates the local data ranges of enabled tables.

1.  **Segment division**:
    Data ranges are divided into small units called "segments." This keeps the amount of data processed at once small, reducing the impact on resources.
2.  **Prioritization**:
    Segments are prioritized based on the need for validation.
3.  **Validation and repair**:
    NodeSync selects segments, reads the data within them, and checks for inconsistencies between replicas. If inconsistencies are found, it performs repairs (data synchronization) as needed.
4.  **Recording validation state**:
    The validation state of each segment is stored in the `system_distributed.nodesync_status` table. This allows administrators to monitor NodeSync's progress and results.

### Segment Validation States

The `system_distributed.nodesync_status` table records the following segment validation states:

-   `successful`: Validation completed normally and consistency was confirmed.
-   `full_in_sync`: The entire segment is fully synchronized.
-   `full_repaired`: The entire segment has been successfully repaired.
-   `unsuccessful`: Validation failed.
-   `partial_in_sync`: Part of the segment is synchronized.
-   `partial_repaired`: Part of the segment has been repaired.
-   `uncompleted`: Validation is incomplete.
-   `failed`: Validation was interrupted due to an error.

NodeSync is an important feature that greatly simplifies data consistency maintenance operations in DSE clusters and improves reliability.
